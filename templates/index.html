<!DOCTYPE html>

<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="static/styles.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <title>OSVFF Shield</title>
    </head>

    <body>
        <div class="container mt-5">
            <h1 class="text-center header" id="first">OSVFF Shield</h1>
            <hr>
            <h5 class="text-center header" id="second">OSVFF (Open Source Vulnerabilities From Friends)</h5>
            <hr>

            <div class="d-flex justify-content-between">
                <div class="left">
                    <p>*<i>We <b>highly</b> condemn using this to find information to do anything malicious.</i>*</p>
                    <p>
                        With how data is all over the internet, it is key to keep yourself safe. 
                        One way to gather information about someone is checking those who might be close to them.
                        Our website allows you to check if you're vulnerable to information leaks due to your friends.
                    </p>
                    <p>
                        Currently, we support finding <i>usernames</i> through <b>TikTok, Facebook, Roblox, GitHub, Youtube</b>
                        and finding that user's friends through Roblox.
                    </p>
                    <p>
                        Upcoming features: Converting fully API usage rather than web scraping,
                        more apps, not just Roblox, to find check Vulnerabilities from friends,
                        AI features that check other usernames similar to the one inputted and show the probability that it's actually them.
                    </p>
                    
                    <form id="searchForm" class="d-flex align-items-center gap-2">
                        <input name="username" placeholder="Username" class="form-control">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </form>
                    
                </div>
                <div class="right">
                    
                </div>
            </div>
        </div>
    </body>

    <script>
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get the username input value
            const username = this.querySelector('input[name="username"]').value;
            
            // Show loading state
            document.querySelector('.right').innerHTML = 'Loading...';
            
            try {
                // Send POST request to /data endpoint
                const response = await fetch('/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `username=${encodeURIComponent(username)}`
                });
                
                // Parse the JSON response
                const result = await response.json();
                
                // Update the right div with the formatted data
                const rightDiv = document.querySelector('.right');
                
                if (result.data) {
                    // Create HTML content from the data
                    let html = '<div class="results">';
                    html += `<h3>Results for ${result.data[0]}</h3>`;
                    
                    // Loop through the data array starting from index 1
                    for (let i = 1; i < 7; i++) {
                        const platformData = result.data[i];
                        const platformName = Object.keys(platformData)[0];
                        
                        html += `
                            <div class="platform-result mb-3">
                                <h5>${platformName}</h5>
                                ${platformData[platformName] ? 
                                    `<p>Found: ✅</p>
                                     <p>Display Name: ${platformData.displayName || 'N/A'}</p>
                                     <p>Profile: <a href="${platformData.profile_url}" target="_blank">View Profile</a></p>`
                                    : 
                                    '<p>Found: ❌</p>'
                                }
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                    rightDiv.innerHTML = html;
                } else {
                    rightDiv.innerHTML = 'No results found';
                }
                
            } catch (error) {
                // Handle any errors
                document.querySelector('.right').innerHTML = 'Error: Could not fetch data';
                console.error('Error:', error);
            }
        });
    </script>
    

</html>